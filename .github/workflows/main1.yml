name: Deploy to Google Play

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
    - name: Install Ruby
      uses: actions/setup-ruby@v1
      with:
        ruby-version: 3.2.4
    - name: Install dependencies
      run: |
        choco install -y android-sdk
        gem install fastlane -NV
        fastlane add_plugin increment_version_code
        fastlane add_plugin increment_version_name
    - name: Build and Deploy
      run: |
        cd android
        bundle exec fastlane android deploy
      env:
        JSON_KEY: ${{ secrets.GOOGLE_PLAY_SERVICE_ACCOUNT_JSON }}
        MYAPP_UPLOAD_STORE_FILE: keystoreupload.keystore
        MYAPP_UPLOAD_STORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
        MYAPP_UPLOAD_KEY_ALIAS: ${{ secrets.ANDROID_KEY_ALIAS }}
        MYAPP_UPLOAD_KEY_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
